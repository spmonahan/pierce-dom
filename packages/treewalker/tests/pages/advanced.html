<!DOCTYPE html>
<html>
  <head>
    <title>Advanced shadow DOM test</title>
    <script type="module" src="/webcomponents/BasicComponent.js"></script>
    <script type="module" src="/webcomponents/DefaultSlotComponent.js"></script>
    <script type="module" src="/webcomponents/NamedSlotsComponent.js"></script>
  </head>

  <body id="body">
    <div id="test-root">
      <div id="first">
        First
        <div id="first-child">
            First child
            <basic-component id="first-grand-child-one">first grand child one</basic-component>
            <div id="first-grand-child-two">First grand child two</div>
        </div>
      </div>

      <basic-component id="second"></basic-component>

      <default-slot-component id="third">
        <default-slot-component id="third-child">
            <div id="third-child-slotted">Third child slotted</div>
        </default-slot-component>
      </default-slot-component>

      <div id="fourth">
        Fourth
        <default-slot-component id="fourth-child">
            <named-slots-component id="fourth-grand-child-one">
                <div id="fourth-grand-child-one-second-slot" slot="second-slot">Fourth grand child second slot</div>
                <div id="fourth-grand-child-one-third-slot" slot="third-slot">Fourth grand child third slot</div>
                <basic-component id="fourth-grand-child-one-first-slot" slot="first-slot"></basic-component>
            </named-slots-component>
        </default-slot-component>
      </div>
    </div>

    <script type="module" id="test-script">
      import { ShadowDomTreeWalker } from '/src/index.js';
      import { addTest } from "/js/utils.js";

      const walk = () => {
        const walker = new ShadowDomTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);
        
        let node = walker.currentNode;
        const nodeIds = [];
        while (node) {
          nodeIds.push(node.id);
          node = walker.nextNode();
        }

        return nodeIds;
      };

      addTest("walk", walk);

      const shadowFirstChild = () => {
        const walker = new ShadowDomTreeWalker(document.getElementById("second"), NodeFilter.SHOW_ELEMENT);
        
        let node = walker.currentNode;
        const nodeIds = [ node.id ];
        
        node = walker.firstChild();
        nodeIds.push(node.id);

        return nodeIds;
      };

      addTest("shadowFirstChild", shadowFirstChild);

      const shadowLastChild = () => {
        const walker = new ShadowDomTreeWalker(document.getElementById("second"), NodeFilter.SHOW_ELEMENT);
        
        let node = walker.currentNode;
        const nodeIds = [ node.id ];
        
        node = walker.lastChild();
        nodeIds.push(node.id);

        return nodeIds;
      };

      addTest("shadowLastChild", shadowLastChild);

      const shadowParentNode = () => {
        const walker = new ShadowDomTreeWalker(document.getElementById("second"), NodeFilter.SHOW_ELEMENT);
        
        let node = walker.currentNode;
        const nodeIds = [ node.id ];
        
        node = walker.lastChild();
        nodeIds.push(node.id);

        node = walker.parentNode();
        nodeIds.push(node.id);

        return nodeIds;
      };

      addTest("shadowParentNode", shadowParentNode);

      const shadowSiblings = () => {
        const walker = new ShadowDomTreeWalker(document.getElementById("second"), NodeFilter.SHOW_ELEMENT);
        
        let node = walker.currentNode;
        const nodeIds = [ node.id ];
        
        node = walker.firstChild();
        nodeIds.push(node.id);

        node = walker.nextSibling();
        nodeIds.push(node.id);
        node = walker.nextSibling();
        nodeIds.push(node.id);

        // null
        node = walker.nextSibling();
        nodeIds.push(node ? node.id : null);

        node = walker.previousSibling();
        nodeIds.push(node.id);
        node = walker.previousSibling();
        nodeIds.push(node.id);

        // null
        node = walker.previousSibling();
        nodeIds.push(node ? node.id : null);

        return nodeIds;
      };

      addTest("shadowSiblings", shadowSiblings);

      const shadowNextPrev = () => {
        const walker = new ShadowDomTreeWalker(document.getElementById("second"), NodeFilter.SHOW_ELEMENT);
        
        let node = walker.currentNode;
        const nodeIds = [];
        
        while (node) {
          nodeIds.push(node.id);
          node = walker.nextNode();
        }

        console.log('nodeIds', nodeIds);
        console.log('node?', walker.currentNode);

        node = walker.previousNode();
        while (node) {
          nodeIds.push(node.id);
          node = walker.previousNode();
        }

        return nodeIds;
      };

      addTest("shadowNextPrev", shadowNextPrev);

    </script>
  </body>
</html>